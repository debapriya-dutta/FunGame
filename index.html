<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Valentine?</title>
  <style>
    :root{
      --bg1:#ff9a9e;
      --bg2:#fad0c4;
      --bg3:#fbc2eb;
      --card:rgba(255,255,255,.92);
      --text:#2b2b2b;
      --muted:rgba(0,0,0,.62);
      --yes:#358717;
      --no:#ff3b5c;
      --shadow:0 22px 60px rgba(0,0,0,.18);
      --ring:0 0 0 4px rgba(255,59,92,.22);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(255,255,255,.35), transparent 55%),
        radial-gradient(900px 650px at 85% 20%, rgba(255,255,255,.25), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
      background-size: 100% 100%;
    }

    /* floating background hearts */
    .bg-heart{
      position:fixed;
      left:0; top:0;
      pointer-events:none;
      opacity:0;
      transform:translateY(0) scale(1);
      animation: bgFloat 10s linear forwards;
      filter: drop-shadow(0 10px 15px rgba(0,0,0,.08));
      will-change: transform, opacity;
      z-index:0;
    }
    @keyframes bgFloat{
      0%{ opacity:0; transform:translateY(20vh) scale(.8) rotate(-10deg); }
      10%{opacity:.35}
      90%{opacity:.18}
      100%{ opacity:0; transform:translateY(-120vh) scale(1.2) rotate(20deg); }
    }

    .card{
      width:min(720px, 92vw);
      background:var(--card);
      border-radius:26px;
      padding:28px 22px 22px;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.05);
      z-index:2;
    }
    /* cute shimmer */
    .card::before{
      content:"";
      position:absolute; inset:-80px;
      background: linear-gradient(110deg, transparent 20%, rgba(255,255,255,.55) 35%, transparent 55%);
      transform: translateX(-60%);
      animation: shimmer 5.5s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes shimmer{
      0%{ transform:translateX(-65%) rotate(8deg); opacity:.2; }
      45%{ opacity:.35; }
      100%{ transform:translateX(65%) rotate(8deg); opacity:.2; }
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      position:relative;
      z-index:2;
    }
    .titleWrap{flex:1}
    h1{
      margin:0 0 6px;
      font-size: clamp(26px, 3.2vw, 42px);
      letter-spacing:.2px;
      line-height:1.1;
    }
    .subtitle{
      margin:0;
      font-size:15px;
      color:var(--muted);
    }

    .pillRow{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      justify-content:center;
      position:relative;
      z-index:2;
    }
    .pill{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.75);
      border:1px solid rgba(0,0,0,.06);
      color:rgba(0,0,0,.65);
      backdrop-filter: blur(8px);
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      position:relative;
      z-index:3;
    }
    .iconBtn{
      width:42px; height:42px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.08);
      background:rgba(255,255,255,.75);
      cursor:pointer;
      display:grid;
      place-items:center;
      box-shadow: 0 10px 20px rgba(0,0,0,.08);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .iconBtn:active{ transform: scale(.98); }
    .iconBtn:focus-visible{ outline:none; box-shadow: var(--ring), 0 10px 20px rgba(0,0,0,.08); }
    .icon{ font-size:18px; transform: translateY(-1px); }

    .playground{
      position:relative;
      height:260px;
      margin-top:14px;
      border-radius:20px;
      background:
        radial-gradient(500px 280px at 25% 25%, rgba(255,59,92,.14), transparent 60%),
        radial-gradient(500px 300px at 75% 20%, rgba(53,135,23,.12), transparent 62%),
        radial-gradient(900px 420px at 50% 120%, rgba(255,255,255,.65), rgba(255,255,255,.0)),
        rgba(255,255,255,.55);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.07);
      z-index:2;
    }

    .btn{
      border:0;
      padding:14px 22px;
      border-radius:16px;
      font-weight:800;
      font-size:16px;
      cursor:pointer;
      user-select:none;
      touch-action:none;
      position:absolute;
      transition: transform .08s ease, filter .12s ease, box-shadow .12s ease;
      will-change: left, top, transform;
    }
    .btn:active{ transform: scale(.98); }
    .btn:focus-visible{ outline:none; box-shadow: var(--ring); }

    .yesBtn{
      left:30%;
      top:64%;
      background:var(--yes);
      color:white;
      box-shadow:0 14px 30px rgba(53,135,23,.28);
    }
    .noBtn{
      left:58%;
      top:64%;
      background:var(--no);
      color:white;
      box-shadow:0 14px 30px rgba(255,59,92,.28);
    }

    .result{
      margin-top:12px;
      min-height:28px;
      font-size:18px;
      font-weight:800;
      position:relative;
      z-index:2;
    }
    .hint{
      margin-top:6px;
      font-size:12px;
      color:rgba(0,0,0,.55);
      position:relative;
      z-index:2;
    }

    .toast{
      position:absolute;
      left:50%;
      top:14px;
      transform:translateX(-50%);
      background:rgba(0,0,0,.75);
      color:#fff;
      padding:8px 12px;
      border-radius:12px;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index:50;
      white-space:nowrap;
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(2px); }

    /* celebration */
    .heartBurst{
      position:fixed;
      pointer-events:none;
      animation: heartUp 1.35s ease forwards;
      will-change: transform, opacity;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.1));
      z-index:999;
    }
    @keyframes heartUp{
      0%{ transform: translateY(0) scale(1); opacity:1; }
      100%{ transform: translateY(-110vh) rotate(240deg) scale(1.15); opacity:0; }
    }
    .confetti{
      position:fixed;
      pointer-events:none;
      opacity:1;
      animation: fall 1.25s linear forwards;
      will-change: transform, opacity;
      z-index:999;
    }
    @keyframes fall{
      0%{ transform: translateY(0) rotate(0deg); opacity:1; }
      100%{ transform: translateY(110vh) rotate(720deg); opacity:0; }
    }

    /* love letter modal */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal.show{ display:flex; }
    .letter{
      width:min(640px, 96vw);
      border-radius:22px;
      background:rgba(255,255,255,.95);
      box-shadow: 0 28px 80px rgba(0,0,0,.24);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.08);
    }
    .letterTop{
      padding:16px 16px 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      background:
        radial-gradient(550px 220px at 10% 0%, rgba(255,59,92,.18), transparent 65%),
        radial-gradient(500px 240px at 90% 0%, rgba(53,135,23,.14), transparent 70%),
        rgba(255,255,255,.65);
      border-bottom:1px solid rgba(0,0,0,.06);
    }
    .letterTitle{
      font-weight:900;
      letter-spacing:.2px;
    }
    .closeBtn{
      border:0;
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      background:rgba(0,0,0,.06);
      font-weight:800;
    }
    .letterBody{
      padding:14px 16px 16px;
      color:rgba(0,0,0,.78);
      line-height:1.5;
      font-size:15px;
    }
    .mediaRow{
      margin-top:12px;
      display:grid;
      grid-template-columns: 120px 1fr;
      gap:12px;
      align-items:center;
    }
    .photo{
      width:120px; height:120px;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.08);
      background: radial-gradient(circle at 30% 30%, rgba(255,59,92,.25), rgba(255,255,255,.0));
      display:grid;
      place-items:center;
      font-size:42px;
    }
    .photo img{
      width:100%; height:100%;
      object-fit:cover;
      display:none;
    }
    .ctaRow{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .cta{
      border:0;
      border-radius:16px;
      padding:12px 14px;
      font-weight:900;
      cursor:pointer;
      background:rgba(0,0,0,.06);
    }
    .cta.primary{
      background: var(--no);
      color:white;
      box-shadow:0 14px 30px rgba(255,59,92,.25);
    }

    /* reduce motion friendly */
    @media (prefers-reduced-motion: reduce){
      .card::before, .bg-heart, .heartBurst, .confetti{ animation: none !important; }
      .btn{ transition:none !important; }
      /* Keep confetti/hearts visible (not animated) so user still "sees" something */
      .confetti, .heartBurst { opacity:1 !important; }
    }
  </style>
</head>

<body>
  <div class="card" role="application" aria-label="Valentine page">
    <div class="toast" id="toast" aria-live="polite"></div>

    <header>
      <div class="titleWrap">
        <h1 id="title">My Valentine? üíò</h1>
        <p class="subtitle" id="subtitle">I have a tiny cute question for you ü•πüíå</p>
      </div>

      <div class="controls">
        <button class="iconBtn" id="musicBtn" aria-label="Toggle music">
          <span class="icon" id="musicIcon">üéµ</span>
        </button>
        <button class="iconBtn" id="resetBtn" aria-label="Reset page">
          <span class="icon">üîÅ</span>
        </button>
      </div>
    </header>

    <div class="pillRow">
      <span class="pill" id="countdown">Valentine starts in ‚Ä¶</span>
      <span class="pill" id="triesPill">No tries: 0</span>
      <span class="pill" id="statusPill">Status: pending</span>
    </div>

    <div class="playground" id="playground" aria-label="Buttons area">
      <button class="btn yesBtn" id="yesBtn">YES üíñ</button>
      <button class="btn noBtn" id="noBtn">NO üôà</button>
    </div>

    <div class="result" id="result"></div>
    <div class="hint" id="hint">Tip: Try to catch ‚ÄúNO‚Äù‚Ä¶ it runs when you come closer üòÑ</div>
  </div>

  <!-- Love letter modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="letter" role="dialog" aria-label="Love letter">
      <div class="letterTop">
        <div class="letterTitle" id="letterTitle">A tiny love letter üíå</div>
        <button class="closeBtn" id="closeModal" aria-label="Close letter">Close</button>
      </div>
      <div class="letterBody">
        <div id="letterText">
          You just made my whole day. Thank you for choosing ‚ÄúYES‚Äù ‚Äî
          I hope we make a thousand sweet memories together. üå∑‚ú®
        </div>

        <div class="mediaRow">
          <div class="photo" id="photoBox" aria-label="Photo or gif reveal">
            <img id="photoImg" alt="Photo" />
            <span id="photoFallback">üíû</span>
          </div>
          <div>
            <div style="font-weight:900; margin-bottom:6px;">PS:</div>
            <div id="psLine">If you‚Äôre smiling right now, my mission is complete üòå</div>
          </div>
        </div>

        <div class="ctaRow">
          <button class="cta" id="copyBtn">Copy this link üîó</button>
          <button class="cta primary" id="shareBtn">Share üíå</button>
        </div>
      </div>
    </div>
  </div>

<script>
  // ---------- Elements ----------
  const qs = new URLSearchParams(location.search);
  const name = (qs.get("name") || "").trim();
  const customMsg = (qs.get("msg") || "").trim();  // optional
  const customPS  = (qs.get("ps")  || "").trim();  // optional
  const photoSrc  = (qs.get("photo") || "").trim(); // optional

  const title = document.getElementById("title");
  const subtitle = document.getElementById("subtitle");
  const result = document.getElementById("result");
  const hint = document.getElementById("hint");
  const countdownEl = document.getElementById("countdown");
  const triesPill = document.getElementById("triesPill");
  const statusPill = document.getElementById("statusPill");

  const yesBtn = document.getElementById("yesBtn");
  const noBtn = document.getElementById("noBtn");
  const playground = document.getElementById("playground");

  const toast = document.getElementById("toast");
  const modal = document.getElementById("modal");
  const closeModal = document.getElementById("closeModal");
  const letterTitle = document.getElementById("letterTitle");
  const letterText = document.getElementById("letterText");
  const psLine = document.getElementById("psLine");
  const photoImg = document.getElementById("photoImg");
  const photoFallback = document.getElementById("photoFallback");
  const copyBtn = document.getElementById("copyBtn");
  const shareBtn = document.getElementById("shareBtn");

  const musicBtn = document.getElementById("musicBtn");
  const musicIcon = document.getElementById("musicIcon");
  const resetBtn = document.getElementById("resetBtn");

  const STORE_KEY = "valentine_yes_v3";

  // ---------- Personalization ----------
  if (name) {
    title.textContent = `Hey ${name}‚Ä¶ will you be my Valentine? üíòü•π`;
    subtitle.textContent = `Just one cute question for you, ${name} üíå‚ú®`;
    letterTitle.textContent = `For ${name} üíå`;
  } else {
    title.textContent = `Will you be my Valentine? üíòü•π`;
  }
  if (customMsg) letterText.textContent = customMsg;
  if (customPS) psLine.textContent = customPS;

  // Optional photo reveal (place photo.jpg in repo OR pass ?photo=...)
  const tryPhoto = photoSrc || "photo.jpg";
  photoImg.src = tryPhoto;
  photoImg.onload = () => { photoImg.style.display = "block"; photoFallback.style.display = "none"; };
  photoImg.onerror = () => { /* fallback stays */ };

  // ---------- Countdown (next Feb 14) ----------
  function nextValentineDate() {
    const now = new Date();
    const y = now.getFullYear();
    let target = new Date(y, 1, 14, 0, 0, 0); // Feb=1
    if (now > target) target = new Date(y + 1, 1, 14, 0, 0, 0);
    return target;
  }
  function formatCountdown(ms) {
    const s = Math.max(0, Math.floor(ms / 1000));
    const d = Math.floor(s / 86400);
    const h = Math.floor((s % 86400) / 3600);
    const m = Math.floor((s % 3600) / 60);
    const ss = s % 60;
    const parts = [];
    if (d) parts.push(`${d}d`);
    parts.push(`${h}h`, `${m}m`, `${ss}s`);
    return parts.join(" ");
  }
  function tickCountdown() {
    const t = nextValentineDate();
    const now = new Date();
    const diff = t - now;
    countdownEl.textContent = diff > 0 ? `Valentine starts in ${formatCountdown(diff)} üíù` : `Happy Valentine‚Äôs Day! üíò`;
  }
  tickCountdown();
  setInterval(tickCountdown, 1000);

  // ---------- Toast ----------
  let toastTimer = null;
  function showToast(msg) {
    if (!msg) return;
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => toast.classList.remove("show"), 900);
  }

  // ---------- Floating background hearts ----------
  const bgHearts = ["üíó","üíñ","üíò","üíù","üíû","üå∏","‚ú®"];
  function spawnBgHeart() {
    if (window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;
    const el = document.createElement("div");
    el.className = "bg-heart";
    el.textContent = bgHearts[Math.floor(Math.random()*bgHearts.length)];
    el.style.left = (Math.random()*100) + "vw";
    el.style.top = (80 + Math.random()*30) + "vh";
    el.style.fontSize = (16 + Math.random()*20) + "px";
    el.style.animationDuration = (8 + Math.random()*6) + "s";
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 14000);
  }
  setInterval(spawnBgHeart, 650);

  // ---------- Runaway NO button (closer = runs more) ----------
  let noTries = 0;
  const tease = [
    "Oops üòá",
    "Nice try üòå",
    "Hehe‚Ä¶ not today üíû",
    "I‚Äôm shy üôà",
    "Too slow üòÑ",
    "Are you sure? ü•∫",
    "Try YES instead üòò",
    "Okay okay‚Ä¶ you‚Äôre persistent üò≥",
    "One more time? üòÖ",
    "Fine‚Ä¶ I‚Äôm getting tired üòµ‚Äçüí´"
  ];
  const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

  function moveNoButton(awayX=null, awayY=null, force=false) {
    const pg = playground.getBoundingClientRect();
    const nb = noBtn.getBoundingClientRect();

    const padding = 10;
    const maxX = pg.width - nb.width - padding;
    const maxY = pg.height - nb.height - padding;

    let x = Math.random() * maxX + padding/2;
    let y = Math.random() * maxY + padding/2;

    if (awayX != null && awayY != null) {
      const relX = awayX - pg.left;
      const relY = awayY - pg.top;
      const dx = x - relX;
      const dy = y - relY;
      const len = Math.hypot(dx, dy) || 1;

      // stronger escape + grows with tries
      const escape = 150 + Math.min(120, noTries * 7);
      x = relX + (dx/len)*escape + (Math.random()-0.5)*70;
      y = relY + (dy/len)*escape + (Math.random()-0.5)*70;

      x = clamp(x, padding, maxX);
      y = clamp(y, padding, maxY);
    }

    // when tries are high, let it be more catchable
    if (noTries >= 10 && !force) {
      x = (x + pg.width*0.48) / 2;
      y = (y + pg.height*0.62) / 2;
    }

    noBtn.style.left = x + "px";
    noBtn.style.top  = y + "px";
  }

  window.addEventListener("load", () => moveNoButton(null, null, true));

  // Make NO run when mouse/finger comes closer (bigger danger radius)
  let lastRun = 0;
  function handlePointerMove(e) {
    if (isYesLocked()) return;

    const now = performance.now();
    if (now - lastRun < 16) return; // ~60fps throttle
    lastRun = now;

    const nb = noBtn.getBoundingClientRect();
    const px = e.clientX, py = e.clientY;
    const cx = nb.left + nb.width/2;
    const cy = nb.top  + nb.height/2;
    const dist = Math.hypot(px - cx, py - cy);

    const danger = 180; // <-- closer sensitivity (increase = runs sooner)
    if (dist < danger) {
      moveNoButton(px, py);
      if (Math.random() < 0.06) showToast("Nopeee üôàüí®");
    }
  }

  playground.addEventListener("mousemove", handlePointerMove);
  playground.addEventListener("touchmove", (e) => {
    const t = e.touches && e.touches[0];
    if (!t) return;
    handlePointerMove({ clientX: t.clientX, clientY: t.clientY });
  }, { passive:true });

  // Make it run immediately when user touches the playground (mobile)
  playground.addEventListener("touchstart", (e) => {
    const t = e.touches && e.touches[0];
    if (!t) return;
    handlePointerMove({ clientX: t.clientX, clientY: t.clientY });
  }, { passive:true });

  // NO tap -> tease + move away + eventually surrenders
  noBtn.addEventListener("pointerdown", (e) => {
    if (isYesLocked()) return;
    e.preventDefault();

    noTries++;
    triesPill.textContent = `No tries: ${noTries}`;
    showToast(tease[Math.min(tease.length-1, noTries-1)]);

    if (noTries === 6) hint.textContent = "Awww you‚Äôre trying so hard üò≥üíû";
    if (noTries === 10) hint.textContent = "Okay‚Ä¶ NO is getting tired üòÖ";
    if (noTries >= 12) {
      noBtn.textContent = "Okay‚Ä¶ YES ü•πüíò";
      noBtn.style.background = "linear-gradient(135deg, #ff3b5c, #ff7aa0)";
      noBtn.style.boxShadow = "0 14px 30px rgba(255,59,92,.30)";
      showToast("Alright‚Ä¶ you win üòåüíñ");
      noBtn.addEventListener("click", triggerYesOnce, { once:true });
    }

    moveNoButton(e.clientX, e.clientY);
  });

  // ---------- YES flow + persistence ----------
  function isYesLocked() {
    return localStorage.getItem(STORE_KEY) === "1";
  }
  function setYesLocked() {
    localStorage.setItem(STORE_KEY, "1");
  }
  function clearYesLocked() {
    localStorage.removeItem(STORE_KEY);
  }

  function triggerYesOnce() {
    if (isYesLocked()) return;
    triggerYes();
  }
  yesBtn.addEventListener("click", triggerYesOnce);

  function triggerYes() {
    setYesLocked();
    statusPill.textContent = "Status: YES üíñ";
    result.textContent = name ? `YAY! ${name} said YES üíû` : "YAY! You said YES üíû";
    result.style.color = "#0d6b3a";
    hint.textContent = "You just unlocked the love letter üíå‚ú®";

    // stop NO escaping
    noBtn.style.pointerEvents = "none";
    noBtn.style.filter = "grayscale(.25)";

    // effects first (so they appear even if modal opens)
    launchConfetti();
    heartBurst();

    // open love letter after a tiny delay so animations paint
    setTimeout(openModal, 120);

    // extra cute background hearts
    for (let i=0;i<6;i++) spawnBgHeart();
  }

  function heartBurst() {
    const emojis = ["üíñ","üíû","üíò","üíù","üå∑","‚ú®","ü•∞"];
    for (let i=0;i<22;i++){
      const h = document.createElement("div");
      h.className = "heartBurst";
      h.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      h.style.left = (Math.random()*100) + "vw";
      h.style.top = (78 + Math.random()*18) + "vh";
      h.style.fontSize = (16 + Math.random()*22) + "px";
      h.style.animationDuration = (1.05 + Math.random()*0.55) + "s";
      document.body.appendChild(h);
      setTimeout(() => h.remove(), 1600);
    }
  }

  function launchConfetti() {
    const colors = ["#ff3b5c","#358717","#ffd166","#6c63ff","#00c2ff","#ff8fab"];
    for (let i=0;i<44;i++){
      const c = document.createElement("div");
      c.className = "confetti";
      c.style.left = (Math.random()*100) + "vw";
      c.style.top = (-6 - Math.random()*12) + "vh";
      c.style.background = colors[Math.floor(Math.random()*colors.length)];
      c.style.borderRadius = (Math.random()>.5 ? "2px" : "999px");
      c.style.width = (8 + Math.random()*8) + "px";
      c.style.height = (8 + Math.random()*10) + "px";
      c.style.animationDuration = (1.0 + Math.random()*0.6) + "s";
      document.body.appendChild(c);
      setTimeout(() => c.remove(), 1700);
    }
  }

  // ---------- Modal ----------
  function openModal(){
    modal.classList.add("show");
    modal.setAttribute("aria-hidden","false");
  }
  function closeLoveLetter(){
    modal.classList.remove("show");
    modal.setAttribute("aria-hidden","true");
  }
  closeModal.addEventListener("click", closeLoveLetter);
  modal.addEventListener("click", (e) => { if (e.target === modal) closeLoveLetter(); });

  // ---------- Share / copy link ----------
  function buildShareLink() {
    const u = new URL(location.href);
    u.searchParams.delete("reset");
    return u.toString();
  }
  copyBtn.addEventListener("click", async () => {
    const link = buildShareLink();
    try{
      await navigator.clipboard.writeText(link);
      showToast("Link copied üíå");
    }catch{
      prompt("Copy this link:", link);
    }
  });
  shareBtn.addEventListener("click", async () => {
    const link = buildShareLink();
    const shareData = { title: "My Valentine?", text: "I have a tiny question üíû", url: link };
    if (navigator.share) {
      try { await navigator.share(shareData); } catch {}
    } else {
      try{
        await navigator.clipboard.writeText(link);
        showToast("Link copied üíå");
      }catch{
        prompt("Copy this link:", link);
      }
    }
  });

  // ---------- Reset ----------
  resetBtn.addEventListener("click", () => {
    clearYesLocked();
    showToast("Reset done üîÅ");
    setTimeout(() => location.reload(), 250);
  });

  // ---------- Restore YES state ----------
  if (isYesLocked()) {
    statusPill.textContent = "Status: YES üíñ";
    result.textContent = name ? `Still YES üíû (Welcome back, ${name}!)` : "Still YES üíû (Welcome back!)";
    result.style.color = "#0d6b3a";
    hint.textContent = "Open the love letter anytime üíå";
    noBtn.style.pointerEvents = "none";
    noBtn.style.filter = "grayscale(.25)";
    showToast("Welcome back üíñ");
  } else {
    statusPill.textContent = "Status: pending";
  }

  // ---------- Romantic music (WebAudio music box) ----------
  // Must be started by user gesture (button click). This version is extra-safe.
  let audioCtx = null;
  let playing = false;
  let tickTimer = null;

  function ensureAudio() {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
  }

  const progression = [
    [261.63, 329.63, 392.00], // C
    [293.66, 369.99, 440.00], // Dm-ish
    [329.63, 415.30, 493.88], // Em-ish
    [349.23, 440.00, 523.25], // F
  ];

  function playNote(freq, when, dur=0.16) {
    const osc = audioCtx.createOscillator();
    const osc2 = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "sine";
    osc2.type = "triangle";
    osc.frequency.value = freq;
    osc2.frequency.value = freq * 2;

    gain.gain.setValueAtTime(0.0001, when);
    gain.gain.exponentialRampToValueAtTime(0.06, when + 0.02);
    gain.gain.exponentialRampToValueAtTime(0.0001, when + dur);

    osc.connect(gain);
    osc2.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(when);
    osc2.start(when);
    osc.stop(when + dur + 0.02);
    osc2.stop(when + dur + 0.02);
  }

  async function startMusic() {
    ensureAudio();
    try {
      if (audioCtx.state === "suspended") await audioCtx.resume();
    } catch (e) {
      showToast("Tap again for music üéµ");
      return;
    }
    if (audioCtx.state !== "running") {
      showToast("Tap again for music üéµ");
      return;
    }

    playing = true;
    musicIcon.textContent = "üé∂";
    showToast("Music on üéµ");

    let step = 0;
    const tempo = 0.22;
    tickTimer = setInterval(() => {
      if (!audioCtx || audioCtx.state !== "running") return;
      const chord = progression[Math.floor(step / 12) % progression.length];
      const n = chord[step % 3];
      const now = audioCtx.currentTime + 0.01;
      playNote(n, now, 0.18);
      step++;
    }, tempo * 1000);
  }

  function stopMusic() {
    playing = false;
    musicIcon.textContent = "üéµ";
    showToast("Music off");
    clearInterval(tickTimer);
    tickTimer = null;
  }

  musicBtn.addEventListener
